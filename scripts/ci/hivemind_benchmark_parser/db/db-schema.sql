-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.benchmark_description
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    description text NOT NULL,
    execution_environment_description text NOT NULL,
    "timestamp" timestamp without time zone NOT NULL,
    server_name text NOT NULL,
    app_version text NOT NULL,
    testsuite_version text NOT NULL,
    runner text NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.testcase
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    api text NOT NULL,
    method text NOT NULL,
    parameters text NOT NULL,
    hash text NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.benchmark_times
(
    benchmark_id bigint NOT NULL,
    testcase_id bigint NOT NULL,
    request_id integer NOT NULL,
    execution_time bigint NOT NULL,
    PRIMARY KEY (benchmark_id, testcase_id, request_id)
);

ALTER TABLE IF EXISTS public.benchmark_times
    ADD FOREIGN KEY (benchmark_id)
    REFERENCES public.benchmark_description (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.benchmark_times
    ADD FOREIGN KEY (testcase_id)
    REFERENCES public.testcase (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


CREATE UNIQUE INDEX unique_testcase_idx ON testcase (hash);

END;